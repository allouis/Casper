{"version":3,"sources":["members-theme-dropin.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","frame","getuid","origin","URL","getAttribute","handlers","listener","window","addEventListener","event","data","uid","handler","error","method","options","cb","contentWindow","postMessage","listen","fn","2","layer0","events","gatewayFn","opts","arguments","undefined","gateway","Promise","resolve","reject","err","res","members","getToken","_ref","audience","fresh","loadGateway","then","getConfig","signout","signin","_ref2","email","password","signup","_ref3","name","requestPasswordReset","_ref4","resetPassword","_ref5","token","verifyEmail","_ref6","bus","src","container","document","body","createElement","style","display","onload","appendChild","loadFrame","gatewayUrl","init","emit","payload","@tryghost/members-layer0","minivents","3","layer1","authUrl","concat","membersUrl","loadAuth","promise","lazyLoadFrame","getAuthFrame","position","width","height","background","top","openAuth","hash","query","messageListener","source","msg","removeEventListener","success","Object","assign","getSSRToken","issuer","upgrade","@tryghost/members-layer1","4","_typeof","obj","Symbol","iterator","constructor","prototype","definition","define","amd","this","_listener","fns","doc","hack","documentElement","doScroll","domContentLoaded","loaded","test","readyState","shift","setTimeout","push","5","on","l","off","splice","slice","apply","6","_slicedToArray","arr","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","value","_iterableToArrayLimit","TypeError","_nonIterableRest","domready","layer2","reload","location","match","hashMatch","tokenMatch","signinEls","querySelectorAll","upgradeEls","signoutEls","setCookie","fetch","credentials","ok","removeCookie","preventDefault","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","el","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_el","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_el2","@tryghost/members-layer2"],"mappings":"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","file":"members-theme-dropin.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n/* globals window */\nmodule.exports = function layer0(frame) {\n  var getuid = function (i) {\n    return function () {\n      return i += 1;\n    };\n  }(1);\n\n  var origin = new URL(frame.getAttribute('src')).origin;\n  var handlers = {};\n\n  var listener = function listener() {};\n\n  window.addEventListener('message', function (event) {\n    if (event.origin !== origin) {\n      return;\n    }\n\n    if (!event.data || !event.data.uid) {\n      if (event.data.event) {\n        return listener(event.data);\n      }\n\n      return;\n    }\n\n    var handler = handlers[event.data.uid];\n\n    if (!handler) {\n      return;\n    }\n\n    delete handlers[event.data.uid];\n    handler(event.data.error, event.data.data);\n  });\n\n  function call(method, options, cb) {\n    var uid = getuid();\n    var data = {\n      uid: uid,\n      method: method,\n      options: options\n    };\n    handlers[uid] = cb;\n    frame.contentWindow.postMessage(data, origin);\n  }\n\n  function listen(fn) {\n    listener = fn;\n  }\n\n  return {\n    call: call,\n    listen: listen\n  };\n};\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\n/* global document */\nvar layer0 = require('@tryghost/members-layer0');\n\nvar events = require('minivents');\n\nmodule.exports = function layer1(options) {\n  var members = {\n    getToken: getToken,\n    getConfig: getConfig,\n    signout: signout,\n    signin: signin,\n    signup: signup,\n    requestPasswordReset: requestPasswordReset,\n    resetPassword: resetPassword,\n    verifyEmail: verifyEmail,\n    bus: new events()\n  };\n  var loadGateway = loadFrame(options.gatewayUrl, options.container).then(function (frame) {\n    var gateway = layer0(frame);\n    var init = gatewayFn('init');\n    gateway.listen(function (data) {\n      members.bus.emit(data.event, data.payload);\n    });\n    return init(gateway).then(function () {\n      return gateway;\n    });\n  });\n\n  function getToken(_ref) {\n    var audience = _ref.audience,\n        fresh = _ref.fresh;\n    return loadGateway.then(gatewayFn('getToken', {\n      audience: audience,\n      fresh: fresh\n    }));\n  }\n\n  function getConfig() {\n    return loadGateway.then(gatewayFn('getConfig'));\n  }\n\n  function signout() {\n    return loadGateway.then(gatewayFn('signout'));\n  }\n\n  function signin(_ref2) {\n    var email = _ref2.email,\n        password = _ref2.password;\n    return loadGateway.then(gatewayFn('signin', {\n      email: email,\n      password: password\n    }));\n  }\n\n  function signup(_ref3) {\n    var name = _ref3.name,\n        email = _ref3.email,\n        password = _ref3.password;\n    return loadGateway.then(gatewayFn('signin', {\n      name: name,\n      email: email,\n      password: password\n    }));\n  }\n\n  function requestPasswordReset(_ref4) {\n    var email = _ref4.email;\n    return loadGateway.then(gatewayFn('request-password-reset', {\n      email: email\n    }));\n  }\n\n  function resetPassword(_ref5) {\n    var token = _ref5.token,\n        password = _ref5.password;\n    return loadGateway.then(gatewayFn('reset-password', {\n      token: token,\n      password: password\n    }));\n  }\n\n  function verifyEmail(_ref6) {\n    var token = _ref6.token;\n    return loadGateway.then(gatewayFn('verify-email', {\n      token: token\n    }));\n  }\n\n  return members;\n};\n\nfunction gatewayFn(method) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return function (gateway) {\n    return new Promise(function (resolve, reject) {\n      gateway.call(method, opts, function (err, res) {\n        if (err) {\n          reject(err);\n        }\n\n        resolve(res);\n      });\n    });\n  };\n}\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer0\":1,\"minivents\":5}],3:[function(require,module,exports){\n\"use strict\";\n\n/* global document window */\nvar layer1 = require('@tryghost/members-layer1');\n\nmodule.exports = function layer2(options) {\n  var authUrl = \"\".concat(options.membersUrl, \"/auth\");\n  var gatewayUrl = \"\".concat(options.membersUrl, \"/gateway\");\n  var container = options.container;\n  var members = layer1({\n    gatewayUrl: gatewayUrl,\n    container: container\n  });\n  var loadAuth = lazyLoadFrame(authUrl, container);\n\n  var getAuthFrame = function getAuthFrame() {\n    return loadAuth().then(function (frame) {\n      frame.style.position = 'fixed';\n      frame.style.width = '100%';\n      frame.style.height = '100%';\n      frame.style.background = 'transparent';\n      frame.style.top = '0';\n      frame.style['z-index'] = '9999';\n      return frame;\n    });\n  };\n\n  function openAuth(hash) {\n    var query = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return getAuthFrame().then(function (frame) {\n      return new Promise(function (resolve) {\n        frame.src = \"\".concat(authUrl, \"#\").concat(hash, \"?\").concat(query);\n        frame.style.display = 'block';\n        window.addEventListener('message', function messageListener(event) {\n          if (event.source !== frame.contentWindow) {\n            return;\n          }\n\n          if (!event.data || event.data.msg !== 'pls-close-auth-popup') {\n            return;\n          }\n\n          window.removeEventListener('message', messageListener);\n          frame.style.display = 'none';\n          resolve(!!event.data.success);\n        });\n      });\n    });\n  }\n\n  function resetPassword(_ref) {\n    var token = _ref.token;\n    var query = \"token=\".concat(token);\n    return openAuth('reset-password', query);\n  }\n\n  function signin() {\n    return openAuth('signin');\n  }\n\n  function upgrade() {\n    return openAuth('upgrade');\n  }\n\n  function getToken(_ref2) {\n    var audience = _ref2.audience,\n        fresh = _ref2.fresh;\n    return members.getToken({\n      audience: audience,\n      fresh: fresh\n    });\n  }\n\n  function getSSRToken() {\n    var _ref3 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        fresh = _ref3.fresh;\n\n    return members.getConfig().then(function (_ref4) {\n      var issuer = _ref4.issuer;\n      return members.getToken({\n        audience: issuer,\n        fresh: fresh\n      });\n    });\n  }\n\n  function signout() {\n    return members.signout();\n  }\n\n  return Object.assign(members.bus, {\n    getToken: getToken,\n    getSSRToken: getSSRToken,\n    signout: signout,\n    signin: signin,\n    upgrade: upgrade,\n    resetPassword: resetPassword\n  });\n};\n\nfunction lazyLoadFrame(src, container) {\n  var promise;\n  return function getFrame() {\n    if (promise) {\n      return promise;\n    }\n\n    promise = loadFrame(src, container);\n    return promise;\n  };\n}\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer1\":2}],4:[function(require,module,exports){\n\"use strict\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/*!\n  * domready (c) Dustin Diaz 2014 - License MIT\n  */\n!function (name, definition) {\n  if (typeof module != 'undefined') module.exports = definition();else if (typeof define == 'function' && _typeof(define.amd) == 'object') define(definition);else this[name] = definition();\n}('domready', function () {\n  var fns = [],\n      _listener,\n      doc = document,\n      hack = doc.documentElement.doScroll,\n      domContentLoaded = 'DOMContentLoaded',\n      loaded = (hack ? /^loaded|^c/ : /^loaded|^i|^c/).test(doc.readyState);\n\n  if (!loaded) doc.addEventListener(domContentLoaded, _listener = function listener() {\n    doc.removeEventListener(domContentLoaded, _listener);\n    loaded = 1;\n\n    while (_listener = fns.shift()) {\n      _listener();\n    }\n  });\n  return function (fn) {\n    loaded ? setTimeout(fn, 0) : fns.push(fn);\n  };\n});\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nmodule.exports = function (n) {\n  var t = {},\n      e = [];\n  n = n || this, n.on = function (e, r, l) {\n    return (t[e] = t[e] || []).push([r, l]), n;\n  }, n.off = function (r, l) {\n    r || (t = {});\n\n    for (var o = t[r] || e, u = o.length = l ? o.length : 0; u--;) {\n      l == o[u][0] && o.splice(u, 1);\n    }\n\n    return n;\n  }, n.emit = function (r) {\n    for (var l, o = t[r] || e, u = o.length > 0 ? o.slice(0, o.length) : o, i = 0; l = u[i++];) {\n      l[0].apply(l[1], e.slice.call(arguments, 1));\n    }\n\n    return n;\n  };\n};\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n/* global window document fetch */\nvar domready = require('domready');\n\nvar layer2 = require('@tryghost/members-layer2');\n\ndomready(setupMembersListeners);\n\nfunction reload(success) {\n  if (success) {\n    window.location.reload();\n  }\n}\n\nfunction setupMembersListeners() {\n  var members = layer2({\n    membersUrl: window.membersUrl\n  });\n\n  var _ref = window.location.hash.match(/^#([^?]+)\\??(.*)$/) || [],\n      _ref2 = _slicedToArray(_ref, 3),\n      hashMatch = _ref2[0],\n      hash = _ref2[1],\n      query = _ref2[2];\n\n  if (hashMatch && hash === 'reset-password') {\n    var _ref3 = query.match(/token=([a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+)/) || [],\n        _ref4 = _slicedToArray(_ref3, 2),\n        tokenMatch = _ref4[0],\n        token = _ref4[1];\n\n    if (tokenMatch) {\n      return members.resetPassword({\n        token: token\n      }).then(function (success) {\n        window.location.hash = '';\n        return success;\n      }).then(reload);\n    }\n  }\n\n  var signinEls = document.querySelectorAll('[data-members-signin]');\n  var upgradeEls = document.querySelectorAll('[data-members-upgrade]');\n  var signoutEls = document.querySelectorAll('[data-members-signout]');\n\n  function setCookie(token) {\n    return fetch('/members/ssr', {\n      method: 'post',\n      credentials: 'include',\n      body: token\n    }).then(function (res) {\n      return !!res.ok;\n    });\n  }\n\n  function removeCookie() {\n    return fetch('/members/ssr', {\n      method: 'delete'\n    }).then(function (res) {\n      return !!res.ok;\n    });\n  }\n\n  members.on('signedin', function () {\n    members.getSSRToken({\n      fresh: true\n    }).then(function (token) {\n      setCookie(token);\n    });\n  });\n  members.on('signedout', function () {\n    removeCookie();\n  });\n\n  function signout(event) {\n    event.preventDefault();\n    members.signout().then(function () {\n      return removeCookie();\n    }).then(reload);\n  }\n\n  function signin(event) {\n    event.preventDefault();\n    members.signin().then(function () {\n      return members.getSSRToken({\n        fresh: true\n      }).then(function (token) {\n        return setCookie(token);\n      });\n    }).then(reload);\n  }\n\n  function upgrade(event) {\n    event.preventDefault();\n    members.upgrade().then(function () {\n      return members.getSSRToken({\n        fresh: true\n      }).then(function (token) {\n        return setCookie(token);\n      });\n    }).then(reload);\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = signinEls[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var el = _step.value;\n      el.addEventListener('click', signin);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = upgradeEls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _el = _step2.value;\n\n      _el.addEventListener('click', upgrade);\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = signoutEls[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _el2 = _step3.value;\n\n      _el2.addEventListener('click', signout);\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n}\n\n},{\"@tryghost/members-layer2\":3,\"domready\":4}]},{},[6]);\n"]}