{"version":3,"sources":["members-theme-dropin.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","frame","getuid","origin","URL","getAttribute","handlers","listener","window","addEventListener","event","data","uid","handler","error","method","options","cb","contentWindow","postMessage","listen","fn","2","layer0","events","gatewayFn","opts","arguments","undefined","gateway","Promise","resolve","reject","err","res","members","getToken","_ref","audience","fresh","loadGateway","then","signout","signin","_ref2","email","password","signup","_ref3","name","requestPasswordReset","_ref4","resetPassword","_ref5","token","verifyEmail","_ref6","bus","src","container","document","body","createElement","style","display","onload","appendChild","loadFrame","gatewayUrl","init","emit","payload","@tryghost/members-layer0","minivents","3","layer1","authUrl","concat","membersUrl","loadAuth","position","width","height","background","top","openAuth","hash","query","messageListener","source","msg","removeEventListener","success","Object","assign","upgrade","@tryghost/members-layer1","4","_typeof","obj","Symbol","iterator","constructor","prototype","definition","define","amd","this","_listener","fns","doc","hack","documentElement","doScroll","domContentLoaded","loaded","test","readyState","shift","setTimeout","push","5","on","l","off","splice","slice","apply","6","_slicedToArray","arr","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","value","_iterableToArrayLimit","TypeError","_nonIterableRest","domready","layer2","reload","location","getClaims","_token$split2","split","claims","JSON","parse","atob","replace","tokenAudience","href","match","hashMatch","tokenMatch","signinEls","querySelectorAll","upgradeEls","signoutEls","setCookie","expiry","Date","exp","cookie","toUTCString","removeCookie","preventDefault","currentCookies","currentToken","now","isTokenExpired","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","el","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_el","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_el2","@tryghost/members-layer2"],"mappings":"CAAY,SAASA,EAAEC,EAAEC,EAAEC,GAAG,SAASC,EAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,IAAIE,EAAE,mBAAmBC,SAASA,QAAQ,IAAIF,GAAGC,EAAE,OAAOA,EAAEF,GAAE,GAAI,GAAGI,EAAE,OAAOA,EAAEJ,GAAE,GAAI,IAAIK,EAAE,IAAIC,MAAM,uBAAuBN,EAAE,KAAK,MAAMK,EAAEE,KAAK,mBAAmBF,EAAE,IAAIG,EAAEX,EAAEG,GAAG,CAACS,QAAQ,IAAIb,EAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAoB,OAAOI,EAAlBH,EAAEI,GAAG,GAAGL,IAAeA,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,OAAOD,EAAEG,GAAGS,QAAQ,IAAI,IAAIL,EAAE,mBAAmBD,SAASA,QAAQH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,IAAI,OAAOD,EAA7b,CAA4c,CAACa,EAAE,CAAC,SAAST,EAAQU,EAAOJ,GACxe,aAGAI,EAAOJ,QAAU,SAAgBK,GAC/B,IAAuBd,EAAnBe,GAAmBf,EAIrB,EAHO,WACL,OAAOA,GAAK,IAIZgB,EAAS,IAAIC,IAAIH,EAAMI,aAAa,QAAQF,OAC5CG,EAAW,GAEXC,EAAW,aAwCf,OAtCAC,OAAOC,iBAAiB,UAAW,SAAUC,GAC3C,GAAIA,EAAMP,SAAWA,EAArB,CAIA,IAAKO,EAAMC,OAASD,EAAMC,KAAKC,IAC7B,OAAIF,EAAMC,KAAKD,MACNH,EAASG,EAAMC,WAGxB,EAGF,IAAIE,EAAUP,EAASI,EAAMC,KAAKC,KAE7BC,WAIEP,EAASI,EAAMC,KAAKC,KAC3BC,EAAQH,EAAMC,KAAKG,MAAOJ,EAAMC,KAAKA,UAkBhC,CACLd,KAhBF,SAAckB,EAAQC,EAASC,GAC7B,IAAIL,EAAMV,IACNS,EAAO,CACTC,IAAKA,EACLG,OAAQA,EACRC,QAASA,GAEXV,EAASM,GAAOK,EAChBhB,EAAMiB,cAAcC,YAAYR,EAAMR,IAStCiB,OANF,SAAgBC,GACdd,EAAWc,MASb,IAAIC,EAAE,CAAC,SAAShC,EAAQU,EAAOJ,GACjC,aAGA,IAAI2B,EAASjC,EAAQ,4BAEjBkC,EAASlC,EAAQ,aAmFrB,SAASmC,EAAUV,GACjB,IAAIW,EAA0B,EAAnBC,UAAU7B,aAA+B8B,IAAjBD,UAAU,GAAmBA,UAAU,GAAK,GAC/E,OAAO,SAAUE,GACf,OAAO,IAAIC,QAAQ,SAAUC,EAASC,GACpCH,EAAQhC,KAAKkB,EAAQW,EAAM,SAAUO,EAAKC,GACpCD,GACFD,EAAOC,GAGTF,EAAQG,QA1FhBlC,EAAOJ,QAAU,SAAgBoB,GAC/B,IAAImB,EAAU,CACZC,SAoBF,SAAkBC,GAChB,IAAIC,EAAWD,EAAKC,SAChBC,EAAQF,EAAKE,MACjB,OAAOC,EAAYC,KAAKhB,EAAU,WAAY,CAC5Ca,SAAUA,EACVC,MAAOA,MAxBTG,QA4BF,WACE,OAAOF,EAAYC,KAAKhB,EAAU,aA5BlCkB,OA+BF,SAAgBC,GACd,IAAIC,EAAQD,EAAMC,MACdC,EAAWF,EAAME,SACrB,OAAON,EAAYC,KAAKhB,EAAU,SAAU,CAC1CoB,MAAOA,EACPC,SAAUA,MAnCZC,OAuCF,SAAgBC,GACd,IAAIC,EAAOD,EAAMC,KACbJ,EAAQG,EAAMH,MACdC,EAAWE,EAAMF,SACrB,OAAON,EAAYC,KAAKhB,EAAU,SAAU,CAC1CwB,KAAMA,EACNJ,MAAOA,EACPC,SAAUA,MA7CZI,qBAiDF,SAA8BC,GAC5B,IAAIN,EAAQM,EAAMN,MAClB,OAAOL,EAAYC,KAAKhB,EAAU,yBAA0B,CAC1DoB,MAAOA,MAnDTO,cAuDF,SAAuBC,GACrB,IAAIC,EAAQD,EAAMC,MACdR,EAAWO,EAAMP,SACrB,OAAON,EAAYC,KAAKhB,EAAU,iBAAkB,CAClD6B,MAAOA,EACPR,SAAUA,MA3DZS,YA+DF,SAAqBC,GACnB,IAAIF,EAAQE,EAAMF,MAClB,OAAOd,EAAYC,KAAKhB,EAAU,eAAgB,CAChD6B,MAAOA,MAjETG,IAAK,IAAIjC,GAEPgB,EAqFN,SAAmBkB,GACjB,IAAIC,EAA+B,EAAnBhC,UAAU7B,aAA+B8B,IAAjBD,UAAU,GAAmBA,UAAU,GAAKiC,SAASC,KAC7F,OAAO,IAAI/B,QAAQ,SAAUC,GAC3B,IAAI9B,EAAQ2D,SAASE,cAAc,UACnC7D,EAAM8D,MAAMC,QAAU,OACtB/D,EAAMyD,IAAMA,EAEZzD,EAAMgE,OAAS,WACblC,EAAQ9B,IAGV0D,EAAUO,YAAYjE,KAhGNkE,CAAUnD,EAAQoD,WAAYpD,EAAQ2C,WAAWlB,KAAK,SAAUxC,GAChF,IAAI4B,EAAUN,EAAOtB,GACjBoE,EAAO5C,EAAU,QAIrB,OAHAI,EAAQT,OAAO,SAAUT,GACvBwB,EAAQsB,IAAIa,KAAK3D,EAAKD,MAAOC,EAAK4D,WAE7BF,EAAKxC,GAASY,KAAK,WACxB,OAAOZ,MA4DX,OAAOM,IAiCP,CAACqC,2BAA2B,EAAEC,UAAY,IAAIC,EAAE,CAAC,SAASpF,EAAQU,EAAOJ,GAC3E,aAGA,IAAI+E,EAASrF,EAAQ,4BAErBU,EAAOJ,QAAU,SAAgBoB,GAC/B,IAAI4D,EAAU,GAAGC,OAAO7D,EAAQ8D,WAAY,SACxCV,EAAa,GAAGS,OAAO7D,EAAQ8D,WAAY,YAC3CnB,EAAY3C,EAAQ2C,UACpBxB,EAAUwC,EAAO,CACnBP,WAAYA,EACZT,UAAWA,IAEToB,EAqEN,SAAmBrB,GACjB,IAAIC,EAA+B,EAAnBhC,UAAU7B,aAA+B8B,IAAjBD,UAAU,GAAmBA,UAAU,GAAKiC,SAASC,KAC7F,OAAO,IAAI/B,QAAQ,SAAUC,GAC3B,IAAI9B,EAAQ2D,SAASE,cAAc,UACnC7D,EAAM8D,MAAMC,QAAU,OACtB/D,EAAMyD,IAAMA,EAEZzD,EAAMgE,OAAS,WACblC,EAAQ9B,IAGV0D,EAAUO,YAAYjE,KAhFTkE,CAAUS,EAASjB,GAAWlB,KAAK,SAAUxC,GAO1D,OANAA,EAAM8D,MAAMiB,SAAW,QACvB/E,EAAM8D,MAAMkB,MAAQ,OACpBhF,EAAM8D,MAAMmB,OAAS,OACrBjF,EAAM8D,MAAMoB,WAAa,cACzBlF,EAAM8D,MAAMqB,IAAM,IAClBnF,EAAM8D,MAAM,WAAa,OAClB9D,IAGT,SAASoF,EAASC,GAChB,IAAIC,EAA2B,EAAnB5D,UAAU7B,aAA+B8B,IAAjBD,UAAU,GAAmBA,UAAU,GAAK,GAChF,OAAOoD,EAAStC,KAAK,SAAUxC,GAC7B,OAAO,IAAI6B,QAAQ,SAAUC,GAC3B9B,EAAMyD,IAAM,GAAGmB,OAAOD,EAAS,KAAKC,OAAOS,EAAM,KAAKT,OAAOU,GAC7DtF,EAAM8D,MAAMC,QAAU,QACtBxD,OAAOC,iBAAiB,UAAW,SAAS+E,EAAgB9E,GACtDA,EAAM+E,SAAWxF,EAAMiB,eAItBR,EAAMC,MAA2B,yBAAnBD,EAAMC,KAAK+E,MAI9BlF,OAAOmF,oBAAoB,UAAWH,GACtCvF,EAAM8D,MAAMC,QAAU,OACtBjC,IAAUrB,EAAMC,KAAKiF,gBAiC7B,OAAOC,OAAOC,OAAO3D,EAAQsB,IAAK,CAChCrB,SAdF,SAAkBQ,GAChB,IAAIN,EAAWM,EAAMN,SACjBC,EAAQK,EAAML,MAClB,OAAOJ,EAAQC,SAAS,CACtBE,SAAUA,EACVC,MAAOA,KAUTG,QANF,WACE,OAAOP,EAAQO,WAMfC,OAxBF,WACE,OAAO0C,EAAS,WAwBhBU,QArBF,WACE,OAAOV,EAAS,YAqBhBjC,cAhCF,SAAuBf,GACrB,IAAIiB,EAAQjB,EAAKiB,MAEjB,OAAO+B,EAAS,iBADJ,SAASR,OAAOvB,SAiD9B,CAAC0C,2BAA2B,IAAIC,EAAE,CAAC,SAAS3G,EAAQU,EAAOJ,GAC7D,aAEA,SAASsG,EAAQC,GAAwT,OAAtOD,EAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,IAKvV,SAAUlD,EAAMuD,QACM,IAAVxG,EAAuBA,EAAOJ,QAAU4G,IAAuC,mBAAVC,QAA+C,UAAvBP,EAAQO,OAAOC,KAAkBD,OAAOD,GAAiBG,KAAS,SAAIH,IAD/K,CAEC,EAAY,WACZ,IACII,EADAC,EAAM,GAENC,EAAMlD,SACNmD,EAAOD,EAAIE,gBAAgBC,SAC3BC,EAAmB,mBACnBC,GAAUJ,EAAO,aAAe,iBAAiBK,KAAKN,EAAIO,YAU9D,OARKF,GAAQL,EAAIrG,iBAAiByG,EAAkBN,EAAY,WAI9D,IAHAE,EAAInB,oBAAoBuB,EAAkBN,GAC1CO,EAAS,EAEFP,EAAYC,EAAIS,SACrBV,MAGG,SAAUvF,GACf8F,EAASI,WAAWlG,EAAI,GAAKwF,EAAIW,KAAKnG,OAIxC,IAAIoG,EAAE,CAAC,SAASnI,EAAQU,EAAOJ,GACjC,aAEAI,EAAOJ,QAAU,SAAUZ,GACzB,IAAIC,EAAI,GACJF,EAAI,IACRC,EAAIA,GAAK2H,MAAQe,GAAK,SAAU3I,EAAGD,EAAG6I,GACpC,OAAQ1I,EAAEF,GAAKE,EAAEF,IAAM,IAAIyI,KAAK,CAAC1I,EAAG6I,IAAK3I,GACxCA,EAAE4I,IAAM,SAAU9I,EAAG6I,GACtB7I,IAAMG,EAAI,IAEV,IAAK,IAAIC,EAAID,EAAEH,IAAMC,EAAGQ,EAAIL,EAAEY,OAAS6H,EAAIzI,EAAEY,OAAS,EAAGP,KACvDoI,GAAKzI,EAAEK,GAAG,IAAML,EAAE2I,OAAOtI,EAAG,GAG9B,OAAOP,GACNA,EAAEsF,KAAO,SAAUxF,GACpB,IAAK,IAAI6I,EAAGzI,EAAID,EAAEH,IAAMC,EAAGQ,EAAe,EAAXL,EAAEY,OAAaZ,EAAE4I,MAAM,EAAG5I,EAAEY,QAAUZ,EAAGC,EAAI,EAAGwI,EAAIpI,EAAEJ,MACnFwI,EAAE,GAAGI,MAAMJ,EAAE,GAAI5I,EAAE+I,MAAMjI,KAAK8B,UAAW,IAG3C,OAAO3C,KAIT,IAAIgJ,EAAE,CAAC,SAAS1I,EAAQU,EAAOJ,GACjC,aAEA,SAASqI,EAAeC,EAAK/I,GAAK,OAMlC,SAAyB+I,GAAO,GAAIC,MAAMC,QAAQF,GAAM,OAAOA,EANtBG,CAAgBH,IAIzD,SAA+BA,EAAK/I,GAAK,IAAImJ,EAAO,GAAQC,GAAK,EAAUC,GAAK,EAAWC,OAAK7G,EAAW,IAAM,IAAK,IAAiC8G,EAA7BC,EAAKT,EAAI9B,OAAOC,cAAmBkC,GAAMG,EAAKC,EAAGC,QAAQC,QAAoBP,EAAKd,KAAKkB,EAAGI,QAAY3J,GAAKmJ,EAAKxI,SAAWX,GAA3DoJ,GAAK,IAAoE,MAAOtG,GAAOuG,GAAK,EAAMC,EAAKxG,EAAO,QAAU,IAAWsG,GAAsB,MAAhBI,EAAW,QAAWA,EAAW,SAAO,QAAU,GAAIH,EAAI,MAAMC,GAAQ,OAAOH,EAJjVS,CAAsBb,EAAK/I,IAE5F,WAA8B,MAAM,IAAI6J,UAAU,wDAFgDC,GASlG,IAAIC,EAAW5J,EAAQ,YAEnB6J,EAAS7J,EAAQ,4BAIrB,SAAS8J,EAAOxD,GACVA,GACFpF,OAAO6I,SAASD,SAmMpB,SAASE,EAAUhG,GACjB,IACE,IACIiG,EAAgBtB,EADD3E,EAAMkG,MAAM,KACkB,GAE7CC,GADSF,EAAc,GACdA,EAAc,IACXA,EAAc,GAI9B,OADmBG,KAAKC,MAAMC,KAAKH,EAAOI,QAAQ,IAAK,KAAKA,QAAQ,IAAK,OAEzE,MAAO9K,GACP,OAAO,MAnNXmK,EAQA,WACE,IAAI/G,EAAUgH,EAAO,CACnBrE,WAAYtE,OAAOsE,aAEjBgF,EAAgB,IAAI1J,IAAII,OAAO6I,SAASU,MAAM5J,OAG9CyC,EAAQqF,EADDzH,OAAO6I,SAAS/D,KAAK0E,MAAM,sBAAwB,GAC7B,GAC7BC,EAAYrH,EAAM,GAClB0C,EAAO1C,EAAM,GACb2C,EAAQ3C,EAAM,GAElB,GAAIqH,GAAsB,mBAAT3E,EAA2B,CAC1C,IAAItC,EAAQuC,EAAMyE,MAAM,yDAA2D,GAC/E7G,EAAQ8E,EAAejF,EAAO,GAC9BkH,EAAa/G,EAAM,GACnBG,EAAQH,EAAM,GAElB,GAAI+G,EACF,OAAO/H,EAAQiB,cAAc,CAC3BE,MAAOA,IACNb,KAAK,SAAUmD,GAEhB,OADApF,OAAO6I,SAAS/D,KAAO,GAChBM,IACNnD,KAAK2G,GAIZ,IAAIe,EAAYvG,SAASwG,iBAAiB,yBACtCC,EAAazG,SAASwG,iBAAiB,0BACvCE,EAAa1G,SAASwG,iBAAiB,0BAE3C,SAASG,EAAUjH,GACjB,IAAImG,EAASH,EAAUhG,GACnBkH,EAAS,IAAIC,KAAkB,IAAbhB,EAAOiB,KAC7B9G,SAAS+G,OAAS,UAAYrH,EAAQ,mBAAqBkH,EAAOI,cAGpE,SAASC,IACPjH,SAAS+G,OAAS,+BA0BpB,SAASjI,EAAQhC,GACfA,EAAMoK,iBACN3I,EAAQO,UAAUD,KAAK,WAErB,OADAoI,KACO,IACNpI,KAAK2G,GAGV,SAASzG,EAAOjC,GACdA,EAAMoK,iBACN3I,EAAQQ,SAASF,KAAK,WACpB,OAAON,EAAQC,SAAS,CACtBE,SAAUwH,EACVvH,OAAO,IACNE,KAAK,SAAUa,GAEhB,OADAiH,EAAUjH,IACH,MAERb,KAAK2G,GAGV,SAASrD,EAAQrF,GACfA,EAAMoK,iBACN3I,EAAQ4D,UAAUtD,KAAK,WACrB,OAAON,EAAQC,SAAS,CACtBE,SAAUwH,EACVvH,OAAO,IACNE,KAAK,SAAUa,GAEhB,OADAiH,EAAUjH,IACH,MAERb,KAAK2G,GAtDVjH,EAAQuF,GAAG,WAAY,WACrB,IAAIqD,EAAiBnH,SAAS+G,OAE1BtH,EAAQ0H,EAAef,MAAM,4DAA8D,CAAC,MAC5FxG,EAAQyE,EAAe5E,EAAO,GAE9B2H,GADkBxH,EAAM,GACTA,EAAM,IAGzB,GAAIwH,GA2HR,SAAwB1H,GACtB,IAAImG,EAASH,EAAUhG,GAEvB,IAAKmG,EACH,OAAO,EAGT,IAAIe,EAAsB,IAAbf,EAAOiB,IAChBO,EAAMR,KAAKQ,MAEf,GAAIT,EAASS,EACX,OAAO,EAGT,OAAO,EAzIeC,CAAeF,GACjC,OAAO7I,EAAQO,UAGjBP,EAAQC,SAAS,CACfE,SAAUwH,IACTrH,KAAK,SAAUa,GAChBiH,EAAUjH,OAGdnB,EAAQuF,GAAG,YAAa,WACtBmD,MAqCF,IAAIM,GAA4B,EAC5BC,GAAoB,EACpBC,OAAiBzJ,EAErB,IACE,IAAK,IAA8C0J,EAA1CC,EAAYpB,EAAU/D,OAAOC,cAAsB8E,GAA6BG,EAAQC,EAAU3C,QAAQC,MAAOsC,GAA4B,EAAM,CAC1J,IAAIK,EAAKF,EAAMxC,MACf0C,EAAG/K,iBAAiB,QAASkC,IAE/B,MAAOV,GACPmJ,GAAoB,EACpBC,EAAiBpJ,EACjB,QACA,IACOkJ,GAAiD,MAApBI,EAAUE,QAC1CF,EAAUE,SAEZ,QACA,GAAIL,EACF,MAAMC,GAKZ,IAAIK,GAA6B,EAC7BC,GAAqB,EACrBC,OAAkBhK,EAEtB,IACE,IAAK,IAAgDiK,EAA5CC,EAAazB,EAAWjE,OAAOC,cAAuBqF,GAA8BG,EAASC,EAAWlD,QAAQC,MAAO6C,GAA6B,EAAM,CACjK,IAAIK,EAAMF,EAAO/C,MAEjBiD,EAAItL,iBAAiB,QAASsF,IAEhC,MAAO9D,GACP0J,GAAqB,EACrBC,EAAkB3J,EAClB,QACA,IACOyJ,GAAmD,MAArBI,EAAWL,QAC5CK,EAAWL,SAEb,QACA,GAAIE,EACF,MAAMC,GAKZ,IAAII,GAA6B,EAC7BC,GAAqB,EACrBC,OAAkBtK,EAEtB,IACE,IAAK,IAAgDuK,EAA5CC,EAAa9B,EAAWlE,OAAOC,cAAuB2F,GAA8BG,EAASC,EAAWxD,QAAQC,MAAOmD,GAA6B,EAAM,CACjK,IAAIK,EAAOF,EAAOrD,MAElBuD,EAAK5L,iBAAiB,QAASiC,IAEjC,MAAOT,GACPgK,GAAqB,EACrBC,EAAkBjK,EAClB,QACA,IACO+J,GAAmD,MAArBI,EAAWX,QAC5CW,EAAWX,SAEb,QACA,GAAIQ,EACF,MAAMC,OAuCZ,CAACI,2BAA2B,EAAEpD,SAAW,KAAK,GAAG,CAAC","file":"members-theme-dropin.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n/* globals window */\nmodule.exports = function layer0(frame) {\n  var getuid = function (i) {\n    return function () {\n      return i += 1;\n    };\n  }(1);\n\n  var origin = new URL(frame.getAttribute('src')).origin;\n  var handlers = {};\n\n  var listener = function listener() {};\n\n  window.addEventListener('message', function (event) {\n    if (event.origin !== origin) {\n      return;\n    }\n\n    if (!event.data || !event.data.uid) {\n      if (event.data.event) {\n        return listener(event.data);\n      }\n\n      return;\n    }\n\n    var handler = handlers[event.data.uid];\n\n    if (!handler) {\n      return;\n    }\n\n    delete handlers[event.data.uid];\n    handler(event.data.error, event.data.data);\n  });\n\n  function call(method, options, cb) {\n    var uid = getuid();\n    var data = {\n      uid: uid,\n      method: method,\n      options: options\n    };\n    handlers[uid] = cb;\n    frame.contentWindow.postMessage(data, origin);\n  }\n\n  function listen(fn) {\n    listener = fn;\n  }\n\n  return {\n    call: call,\n    listen: listen\n  };\n};\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\n/* global document */\nvar layer0 = require('@tryghost/members-layer0');\n\nvar events = require('minivents');\n\nmodule.exports = function layer1(options) {\n  var members = {\n    getToken: getToken,\n    signout: signout,\n    signin: signin,\n    signup: signup,\n    requestPasswordReset: requestPasswordReset,\n    resetPassword: resetPassword,\n    verifyEmail: verifyEmail,\n    bus: new events()\n  };\n  var loadGateway = loadFrame(options.gatewayUrl, options.container).then(function (frame) {\n    var gateway = layer0(frame);\n    var init = gatewayFn('init');\n    gateway.listen(function (data) {\n      members.bus.emit(data.event, data.payload);\n    });\n    return init(gateway).then(function () {\n      return gateway;\n    });\n  });\n\n  function getToken(_ref) {\n    var audience = _ref.audience,\n        fresh = _ref.fresh;\n    return loadGateway.then(gatewayFn('getToken', {\n      audience: audience,\n      fresh: fresh\n    }));\n  }\n\n  function signout() {\n    return loadGateway.then(gatewayFn('signout'));\n  }\n\n  function signin(_ref2) {\n    var email = _ref2.email,\n        password = _ref2.password;\n    return loadGateway.then(gatewayFn('signin', {\n      email: email,\n      password: password\n    }));\n  }\n\n  function signup(_ref3) {\n    var name = _ref3.name,\n        email = _ref3.email,\n        password = _ref3.password;\n    return loadGateway.then(gatewayFn('signin', {\n      name: name,\n      email: email,\n      password: password\n    }));\n  }\n\n  function requestPasswordReset(_ref4) {\n    var email = _ref4.email;\n    return loadGateway.then(gatewayFn('request-password-reset', {\n      email: email\n    }));\n  }\n\n  function resetPassword(_ref5) {\n    var token = _ref5.token,\n        password = _ref5.password;\n    return loadGateway.then(gatewayFn('reset-password', {\n      token: token,\n      password: password\n    }));\n  }\n\n  function verifyEmail(_ref6) {\n    var token = _ref6.token;\n    return loadGateway.then(gatewayFn('verify-email', {\n      token: token\n    }));\n  }\n\n  return members;\n};\n\nfunction gatewayFn(method) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return function (gateway) {\n    return new Promise(function (resolve, reject) {\n      gateway.call(method, opts, function (err, res) {\n        if (err) {\n          reject(err);\n        }\n\n        resolve(res);\n      });\n    });\n  };\n}\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer0\":1,\"minivents\":5}],3:[function(require,module,exports){\n\"use strict\";\n\n/* global document window */\nvar layer1 = require('@tryghost/members-layer1');\n\nmodule.exports = function layer2(options) {\n  var authUrl = \"\".concat(options.membersUrl, \"/auth\");\n  var gatewayUrl = \"\".concat(options.membersUrl, \"/gateway\");\n  var container = options.container;\n  var members = layer1({\n    gatewayUrl: gatewayUrl,\n    container: container\n  });\n  var loadAuth = loadFrame(authUrl, container).then(function (frame) {\n    frame.style.position = 'fixed';\n    frame.style.width = '100%';\n    frame.style.height = '100%';\n    frame.style.background = 'transparent';\n    frame.style.top = '0';\n    frame.style['z-index'] = '9999';\n    return frame;\n  });\n\n  function openAuth(hash) {\n    var query = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return loadAuth.then(function (frame) {\n      return new Promise(function (resolve) {\n        frame.src = \"\".concat(authUrl, \"#\").concat(hash, \"?\").concat(query);\n        frame.style.display = 'block';\n        window.addEventListener('message', function messageListener(event) {\n          if (event.source !== frame.contentWindow) {\n            return;\n          }\n\n          if (!event.data || event.data.msg !== 'pls-close-auth-popup') {\n            return;\n          }\n\n          window.removeEventListener('message', messageListener);\n          frame.style.display = 'none';\n          resolve(!!event.data.success);\n        });\n      });\n    });\n  }\n\n  function resetPassword(_ref) {\n    var token = _ref.token;\n    var query = \"token=\".concat(token);\n    return openAuth('reset-password', query);\n  }\n\n  function signin() {\n    return openAuth('signin');\n  }\n\n  function upgrade() {\n    return openAuth('upgrade');\n  }\n\n  function getToken(_ref2) {\n    var audience = _ref2.audience,\n        fresh = _ref2.fresh;\n    return members.getToken({\n      audience: audience,\n      fresh: fresh\n    });\n  }\n\n  function signout() {\n    return members.signout();\n  }\n\n  return Object.assign(members.bus, {\n    getToken: getToken,\n    signout: signout,\n    signin: signin,\n    upgrade: upgrade,\n    resetPassword: resetPassword\n  });\n};\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer1\":2}],4:[function(require,module,exports){\n\"use strict\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/*!\n  * domready (c) Dustin Diaz 2014 - License MIT\n  */\n!function (name, definition) {\n  if (typeof module != 'undefined') module.exports = definition();else if (typeof define == 'function' && _typeof(define.amd) == 'object') define(definition);else this[name] = definition();\n}('domready', function () {\n  var fns = [],\n      _listener,\n      doc = document,\n      hack = doc.documentElement.doScroll,\n      domContentLoaded = 'DOMContentLoaded',\n      loaded = (hack ? /^loaded|^c/ : /^loaded|^i|^c/).test(doc.readyState);\n\n  if (!loaded) doc.addEventListener(domContentLoaded, _listener = function listener() {\n    doc.removeEventListener(domContentLoaded, _listener);\n    loaded = 1;\n\n    while (_listener = fns.shift()) {\n      _listener();\n    }\n  });\n  return function (fn) {\n    loaded ? setTimeout(fn, 0) : fns.push(fn);\n  };\n});\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nmodule.exports = function (n) {\n  var t = {},\n      e = [];\n  n = n || this, n.on = function (e, r, l) {\n    return (t[e] = t[e] || []).push([r, l]), n;\n  }, n.off = function (r, l) {\n    r || (t = {});\n\n    for (var o = t[r] || e, u = o.length = l ? o.length : 0; u--;) {\n      l == o[u][0] && o.splice(u, 1);\n    }\n\n    return n;\n  }, n.emit = function (r) {\n    for (var l, o = t[r] || e, u = o.length > 0 ? o.slice(0, o.length) : o, i = 0; l = u[i++];) {\n      l[0].apply(l[1], e.slice.call(arguments, 1));\n    }\n\n    return n;\n  };\n};\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n/* global window document atob */\nvar domready = require('domready');\n\nvar layer2 = require('@tryghost/members-layer2');\n\ndomready(setupMembersListeners);\n\nfunction reload(success) {\n  if (success) {\n    window.location.reload();\n  }\n}\n\nfunction setupMembersListeners() {\n  var members = layer2({\n    membersUrl: window.membersUrl\n  });\n  var tokenAudience = new URL(window.location.href).origin;\n\n  var _ref = window.location.hash.match(/^#([^?]+)\\??(.*)$/) || [],\n      _ref2 = _slicedToArray(_ref, 3),\n      hashMatch = _ref2[0],\n      hash = _ref2[1],\n      query = _ref2[2];\n\n  if (hashMatch && hash === 'reset-password') {\n    var _ref3 = query.match(/token=([a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+)/) || [],\n        _ref4 = _slicedToArray(_ref3, 2),\n        tokenMatch = _ref4[0],\n        token = _ref4[1];\n\n    if (tokenMatch) {\n      return members.resetPassword({\n        token: token\n      }).then(function (success) {\n        window.location.hash = '';\n        return success;\n      }).then(reload);\n    }\n  }\n\n  var signinEls = document.querySelectorAll('[data-members-signin]');\n  var upgradeEls = document.querySelectorAll('[data-members-upgrade]');\n  var signoutEls = document.querySelectorAll('[data-members-signout]');\n\n  function setCookie(token) {\n    var claims = getClaims(token);\n    var expiry = new Date(claims.exp * 1000);\n    document.cookie = 'member=' + token + ';Path=/;expires=' + expiry.toUTCString();\n  }\n\n  function removeCookie() {\n    document.cookie = 'member=null;Path=/;max-age=0';\n  }\n\n  members.on('signedin', function () {\n    var currentCookies = document.cookie;\n\n    var _ref5 = currentCookies.match(/member=([a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]*)/) || [null],\n        _ref6 = _slicedToArray(_ref5, 2),\n        hasCurrentToken = _ref6[0],\n        currentToken = _ref6[1]; // eslint-disable-line no-unused-vars\n\n\n    if (currentToken && isTokenExpired(currentToken)) {\n      return members.signout();\n    }\n\n    members.getToken({\n      audience: tokenAudience\n    }).then(function (token) {\n      setCookie(token);\n    });\n  });\n  members.on('signedout', function () {\n    removeCookie();\n  });\n\n  function signout(event) {\n    event.preventDefault();\n    members.signout().then(function () {\n      removeCookie();\n      return true;\n    }).then(reload);\n  }\n\n  function signin(event) {\n    event.preventDefault();\n    members.signin().then(function () {\n      return members.getToken({\n        audience: tokenAudience,\n        fresh: true\n      }).then(function (token) {\n        setCookie(token);\n        return true;\n      });\n    }).then(reload);\n  }\n\n  function upgrade(event) {\n    event.preventDefault();\n    members.upgrade().then(function () {\n      return members.getToken({\n        audience: tokenAudience,\n        fresh: true\n      }).then(function (token) {\n        setCookie(token);\n        return true;\n      });\n    }).then(reload);\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = signinEls[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var el = _step.value;\n      el.addEventListener('click', signin);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = upgradeEls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _el = _step2.value;\n\n      _el.addEventListener('click', upgrade);\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = signoutEls[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _el2 = _step3.value;\n\n      _el2.addEventListener('click', signout);\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n}\n\nfunction isTokenExpired(token) {\n  var claims = getClaims(token);\n\n  if (!claims) {\n    return true;\n  }\n\n  var expiry = claims.exp * 1000;\n  var now = Date.now();\n\n  if (expiry < now) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction getClaims(token) {\n  try {\n    var _token$split = token.split('.'),\n        _token$split2 = _slicedToArray(_token$split, 3),\n        header = _token$split2[0],\n        claims = _token$split2[1],\n        signature = _token$split2[2]; // eslint-disable-line no-unused-vars\n\n\n    var parsedClaims = JSON.parse(atob(claims.replace('+', '-').replace('/', '_')));\n    return parsedClaims;\n  } catch (e) {\n    return null;\n  }\n}\n\n},{\"@tryghost/members-layer2\":3,\"domready\":4}]},{},[6]);\n"]}