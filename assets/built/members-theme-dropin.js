!function i(u,a,s){function c(e,n){if(!a[e]){if(!u[e]){var t="function"==typeof require&&require;if(!n&&t)return t(e,!0);if(f)return f(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};u[e][0].call(o.exports,function(n){return c(u[e][1][n]||n)},o,o.exports,i,u,a,s)}return a[e].exports}for(var f="function"==typeof require&&require,n=0;n<s.length;n++)c(s[n]);return c}({1:[function(n,e,t){"use strict";e.exports=function(i){var n,u=(n=1,function(){return n+=1}),a=new URL(i.getAttribute("src")).origin,s={},t=function(){};return window.addEventListener("message",function(n){if(n.origin===a){if(!n.data||!n.data.uid)return n.data.event?t(n.data):void 0;var e=s[n.data.uid];e&&(delete s[n.data.uid],e(n.data.error,n.data.data))}}),{call:function(n,e,t){var r=u(),o={uid:r,method:n,options:e};s[r]=t,i.contentWindow.postMessage(o,a)},listen:function(n){t=n}}}},{}],2:[function(n,e,t){"use strict";var i=n("@tryghost/members-layer0"),u=n("minivents");function a(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(n){return new Promise(function(t,r){n.call(e,o,function(n,e){n&&r(n),t(e)})})}}e.exports=function(n){var r={getToken:function(n){var e=n.audience,t=n.fresh;return o.then(a("getToken",{audience:e,fresh:t}))},getConfig:function(){return o.then(a("getConfig"))},signout:function(){return o.then(a("signout"))},signin:function(n){var e=n.email,t=n.password;return o.then(a("signin",{email:e,password:t}))},signup:function(n){var e=n.name,t=n.email,r=n.password;return o.then(a("signin",{name:e,email:t,password:r}))},requestPasswordReset:function(n){var e=n.email;return o.then(a("request-password-reset",{email:e}))},resetPassword:function(n){var e=n.token,t=n.password;return o.then(a("reset-password",{token:e,password:t}))},verifyEmail:function(n){var e=n.token;return o.then(a("verify-email",{token:e}))},bus:new u},o=function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;return new Promise(function(n){var e=document.createElement("iframe");e.style.display="none",e.src=t,e.onload=function(){n(e)},r.appendChild(e)})}(n.gatewayUrl,n.container).then(function(n){var e=i(n),t=a("init");return e.listen(function(n){r.bus.emit(n.event,n.payload)}),t(e).then(function(){return e})});return r}},{"@tryghost/members-layer0":1,minivents:5}],3:[function(n,e,t){"use strict";var s=n("@tryghost/members-layer1");e.exports=function(n){var o="".concat(n.membersUrl,"/auth"),e="".concat(n.membersUrl,"/gateway"),t=n.container,r=s({gatewayUrl:e,container:t}),i=function(n,e){var t;return function(){return t||(t=function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;return new Promise(function(n){var e=document.createElement("iframe");e.style.display="none",e.src=t,e.onload=function(){n(e)},r.appendChild(e)})}(n,e))}}(o,t),u=function(){return i().then(function(n){return n.style.position="fixed",n.style.width="100%",n.style.height="100%",n.style.background="transparent",n.style.top="0",n.style["z-index"]="9999",n})};function a(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return u().then(function(r){return new Promise(function(t){r.src="".concat(o,"#").concat(n,"?").concat(e),r.style.display="block",window.addEventListener("message",function n(e){e.source===r.contentWindow&&e.data&&"pls-close-auth-popup"===e.data.msg&&(window.removeEventListener("message",n),r.style.display="none",t(!!e.data.success))})})})}return Object.assign(r.bus,{getToken:function(n){var e=n.audience,t=n.fresh;return r.getToken({audience:e,fresh:t})},getSSRToken:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).fresh;return r.getConfig().then(function(n){var e=n.issuer;return r.getToken({audience:e,fresh:t})})},signout:function(){return r.signout()},signin:function(){return a("signin")},upgrade:function(){return a("upgrade")},resetPassword:function(n){var e=n.token;return a("reset-password","token=".concat(e))}})}},{"@tryghost/members-layer1":2}],4:[function(n,t,e){"use strict";function r(n){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}!function(n,e){void 0!==t?t.exports=e():"function"==typeof define&&"object"==r(define.amd)?define(e):this.domready=e()}(0,function(){var n,e=[],t=document,r=t.documentElement.doScroll,o="DOMContentLoaded",i=(r?/^loaded|^c/:/^loaded|^i|^c/).test(t.readyState);return i||t.addEventListener(o,n=function(){for(t.removeEventListener(o,n),i=1;n=e.shift();)n()}),function(n){i?setTimeout(n,0):e.push(n)}})},{}],5:[function(n,e,t){"use strict";e.exports=function(i){var u={},a=[];(i=i||this).on=function(n,e,t){return(u[n]=u[n]||[]).push([e,t]),i},i.off=function(n,e){n||(u={});for(var t=u[n]||a,r=t.length=e?t.length:0;r--;)e==t[r][0]&&t.splice(r,1);return i},i.emit=function(n){for(var e,t=u[n]||a,r=0<t.length?t.slice(0,t.length):t,o=0;e=r[o++];)e[0].apply(e[1],a.slice.call(arguments,1));return i}}},{}],6:[function(n,e,t){"use strict";function _(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=[],r=!0,o=!1,i=void 0;try{for(var u,a=n[Symbol.iterator]();!(r=(u=a.next()).done)&&(t.push(u.value),!e||t.length!==e);r=!0);}catch(n){o=!0,i=n}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return t}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var r=n("domready"),z=n("@tryghost/members-layer2");function M(n){n&&window.location.reload()}r(function(){var e=z({membersUrl:window.membersUrl}),n=_(window.location.hash.match(/^#([^?]+)\??(.*)$/)||[],3),t=n[0],r=n[1],o=n[2];if(t&&"reset-password"===r){var i=o.match(/token=([a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+)/)||[],u=_(i,2),a=u[0],s=u[1];if(a)return e.resetPassword({token:s}).then(function(n){return window.location.hash="",n}).then(M)}var c=document.querySelectorAll("[data-members-signin]"),f=document.querySelectorAll("[data-members-upgrade]"),l=document.querySelectorAll("[data-members-signout]");function d(n){return fetch("/members/ssr",{method:"post",credentials:"include",body:n}).then(function(n){return!!n.ok})}function m(){return fetch("/members/ssr",{method:"delete"}).then(function(n){return!!n.ok})}function h(n){n.preventDefault(),e.signout().then(function(){return m()}).then(M)}function v(n){n.preventDefault(),e.signin().then(function(){return e.getSSRToken({fresh:!0}).then(function(n){return d(n)})}).then(M)}function y(n){n.preventDefault(),e.upgrade().then(function(){return e.getSSRToken({fresh:!0}).then(function(n){return d(n)})}).then(M)}e.on("signedin",function(){e.getSSRToken({fresh:!0}).then(function(n){d(n)})}),e.on("signedout",function(){m()});var g=!0,p=!1,w=void 0;try{for(var b,k=c[Symbol.iterator]();!(g=(b=k.next()).done);g=!0){var S=b.value;S.addEventListener("click",v)}}catch(n){p=!0,w=n}finally{try{g||null==k.return||k.return()}finally{if(p)throw w}}var x=!0,E=!1,T=void 0;try{for(var L,q=f[Symbol.iterator]();!(x=(L=q.next()).done);x=!0){var A=L.value;A.addEventListener("click",y)}}catch(n){E=!0,T=n}finally{try{x||null==q.return||q.return()}finally{if(E)throw T}}var U=!0,P=!1,C=void 0;try{for(var D,R=l[Symbol.iterator]();!(U=(D=R.next()).done);U=!0){var O=D.value;O.addEventListener("click",h)}}catch(n){P=!0,C=n}finally{try{U||null==R.return||R.return()}finally{if(P)throw C}}})},{"@tryghost/members-layer2":3,domready:4}]},{},[6]);
//# sourceMappingURL=members-theme-dropin.js.map